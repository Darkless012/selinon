<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>YAML Configuration &#8212; Selinon 0.1.0rc1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0rc1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Selinon 0.1.0rc1 documentation" href="index.html" />
    <link rel="next" title="Task Implementation" href="tasks.html" />
    <link rel="prev" title="Frequently Asked Questions (FAQ)" href="faq.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="yaml-configuration">
<h1>YAML Configuration<a class="headerlink" href="#yaml-configuration" title="Permalink to this headline">¶</a></h1>
<p>The only thing you have to provide is a configuration file that describes how should be your flow organized. A flow is defined by nodes that can be either tasks or another flows (subflows). Once you create a YAML configuration file, this file is parsed and checked using Selinonlib tool (you can even visualize your flows based on configuration). Selinonlib automatically generates Python code for Dispatcher to let Dispatcher know what to do when.</p>
<p>Now let&#8217;s a look at YAML configuration file structure. At the top level, there are listed following keys:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>
  <span class="c1"># a list of tasks available within the system</span>
<span class="l l-Scalar l-Scalar-Plain">flows</span><span class="p p-Indicator">:</span>
  <span class="c1"># a list of flows available within the system</span>
<span class="l l-Scalar l-Scalar-Plain">storages</span><span class="p p-Indicator">:</span>
  <span class="c1"># a list of storages available within the system</span>
<span class="l l-Scalar l-Scalar-Plain">global</span><span class="p p-Indicator">:</span>
  <span class="c1"># global Selinon configuration</span>
<span class="l l-Scalar l-Scalar-Plain">flow-definitions</span><span class="p p-Indicator">:</span>
  <span class="c1"># a list of flow definitions</span>
</pre></div>
</div>
<div class="section" id="entities-in-system">
<h2>Entities in System<a class="headerlink" href="#entities-in-system" title="Permalink to this headline">¶</a></h2>
<p>There are two main entities in the system:</p>
<blockquote>
<div><ul class="simple">
<li>tasks</li>
<li>storages</li>
</ul>
</div></blockquote>
<p>Tasks are organized into flows based on dependencies defined by you in your configuration file. Each flow can be used as a subflow and can become a part of another flow. This way you can see tasks as nodes in dependency graph and flows as nodes as well.</p>
</div>
<div class="section" id="tasks">
<h2>Tasks<a class="headerlink" href="#tasks" title="Permalink to this headline">¶</a></h2>
<p>Configuration of a task in configuration can look like the following example.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>
   <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&#39;MyTask1&#39;</span>
     <span class="l l-Scalar l-Scalar-Plain">classname</span><span class="p p-Indicator">:</span> <span class="s">&#39;MyTask1Class&#39;</span>
     <span class="l l-Scalar l-Scalar-Plain">import</span><span class="p p-Indicator">:</span> <span class="s">&#39;myproject.workers&#39;</span>
     <span class="l l-Scalar l-Scalar-Plain">max_retry</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
     <span class="l l-Scalar l-Scalar-Plain">retry_countdown</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">120</span>
     <span class="l l-Scalar l-Scalar-Plain">output_schema</span><span class="p p-Indicator">:</span> <span class="s">&#39;myproject/schemas/my-task1.json&#39;</span>
     <span class="l l-Scalar l-Scalar-Plain">storage</span><span class="p p-Indicator">:</span> <span class="s">&quot;Storage1&quot;</span>
     <span class="l l-Scalar l-Scalar-Plain">queue</span><span class="p p-Indicator">:</span> <span class="s">&#39;my_task1_queue&#39;</span>
</pre></div>
</div>
<p>A task definition has to be placed into <cite>tasks</cite> section, which consists of list of task definitions.</p>
<p>A list of all configuration options:</p>
<div class="section" id="name">
<h3><cite>name</cite><a class="headerlink" href="#name" title="Permalink to this headline">¶</a></h3>
<p>A name of a task. This name is used to refer task in your flows, it is not necessarily task&#8217;s class name (see <cite>classname</cite> option).</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string</li>
</ul>
</li>
<li>Required: True</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="import">
<h3><cite>import</cite><a class="headerlink" href="#import" title="Permalink to this headline">¶</a></h3>
<p>Module that should be imported in order to use a task.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string</li>
</ul>
</li>
<li>Required: True</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="classname">
<h3><cite>classname</cite><a class="headerlink" href="#classname" title="Permalink to this headline">¶</a></h3>
<p>Name of a class that should be imported. If omitted it defaults to <cite>name</cite>. Task <cite>MyTask1</cite> from example is then imported as:
<code class="docutils literal"><span class="pre">`python</span>
<span class="pre">from</span> <span class="pre">myproject.workers</span> <span class="pre">import</span> <span class="pre">MyTask1Class</span>
<span class="pre">#</span> <span class="pre">if</span> <span class="pre">classname</span> <span class="pre">is</span> <span class="pre">omitted:</span>
<span class="pre">#from</span> <span class="pre">myproject.workers</span> <span class="pre">import</span> <span class="pre">MyTask1</span>
<span class="pre">`</span></code></p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string</li>
</ul>
</li>
<li>Required: False</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>Default:</dt>
<dd>defaults to task&#8217;s <cite>name</cite></dd>
</dl>
</div>
<div class="section" id="max-retry">
<h3><cite>max_retry</cite><a class="headerlink" href="#max-retry" title="Permalink to this headline">¶</a></h3>
<p>Maximum number of retries of the task before the task is marked as <em>failed</em>. See fallbacks section for more info.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>nonzero integer</li>
</ul>
</li>
<li>Required: False</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>Default:</dt>
<dd>0 - a task is run only once without retry</dd>
</dl>
</div>
<div class="section" id="retry-countdown">
<h3><cite>retry_countdown</cite><a class="headerlink" href="#retry-countdown" title="Permalink to this headline">¶</a></h3>
<p>Number of seconds before a task should be retried.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>positive integer or positive float, can be set to zero</li>
</ul>
</li>
<li>Required: False</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>Default:</dt>
<dd>zero</dd>
</dl>
</div>
<div class="section" id="output-schema">
<h3><cite>output_schema</cite><a class="headerlink" href="#output-schema" title="Permalink to this headline">¶</a></h3>
<p>JSON output schema that should be used to validate results before they are stored in database. If task&#8217;s result does not correspond to JSON schema, task fails and is marked as failed or retried based on <cite>max_retry</cite> configuration option.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string - path to JSON schema</li>
</ul>
</li>
<li>Required: False</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>Default:</dt>
<dd>None</dd>
</dl>
</div>
<div class="section" id="storage">
<h3><cite>storage</cite><a class="headerlink" href="#storage" title="Permalink to this headline">¶</a></h3>
<p>Storage name that should be used for task results; see Storages section.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string - name of storage</li>
</ul>
</li>
<li>Required: False</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>Default:</dt>
<dd>None</dd>
</dl>
</div>
<div class="section" id="queue">
<h3><cite>queue</cite><a class="headerlink" href="#queue" title="Permalink to this headline">¶</a></h3>
<p>Queue that should be used by Celery for task, see Celery&#8217;s queue <a class="reference external" href="http://docs.celeryproject.org/en/latest/userguide/routing.html#id2">documentation</a>.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string - name of queue</li>
</ul>
</li>
<li>Required: False</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>Default:</dt>
<dd>celery (celery&#8217;s default queue)</dd>
</dl>
</div>
</div>
<div class="section" id="storages">
<h2>Storages<a class="headerlink" href="#storages" title="Permalink to this headline">¶</a></h2>
<p>Here is an example of storage configuration:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">storages</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;Storage1&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">import</span><span class="p p-Indicator">:</span> <span class="s">&quot;selinon.storage&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">classname</span><span class="p p-Indicator">:</span> <span class="s">&quot;SqlStorage&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">configuration</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">connection_string</span><span class="p p-Indicator">:</span> <span class="s">&#39;postgresql://postgres:postgres@localhost:5432/mydatabase&#39;</span>
      <span class="l l-Scalar l-Scalar-Plain">echo</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
<p>A storage definition has to be placed into <cite>storages</cite> section, which is a list of storage definitions.</p>
<p>A list of all configuration options:</p>
<div class="section" id="id1">
<h3><cite>name</cite><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>A name of a storage. This name is used to refer storage in tasks.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string - name of storage</li>
</ul>
</li>
<li>Required: True</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id2">
<h3><cite>import</cite><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Module that holds storage class definition.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string - import</li>
</ul>
</li>
<li>Required: True</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id3">
<h3><cite>classname</cite><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>A name of a database storage adapter class in <cite>import</cite> module. The class from example is imported as:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">from selinon.storage import SqlStorage</span>
<span class="l l-Scalar l-Scalar-Plain"># if classname is omitted</span>
<span class="l l-Scalar l-Scalar-Plain">#from selinon.storage improt Storage1</span>
</pre></div>
</div>
<p>Configuration:</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string</li>
</ul>
</li>
<li>Required: False</li>
</ul>
</div></blockquote>
<p>Default:
storage <cite>name</cite></p>
</div>
<div class="section" id="configuration">
<h3><cite>configuration</cite><a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>Configuration that will be passed to storage adapter instance. This option depends on database adapter implementation, see Storage Implementation section.</p>
</div>
</div>
<div class="section" id="flows">
<h2>Flows<a class="headerlink" href="#flows" title="Permalink to this headline">¶</a></h2>
<p>As stated above, a flow can become a node in dependency graph. This means that you can reuse a flow across multiple flows - flow can become a subflow.</p>
</div>
<div class="section" id="flow-definition">
<h2>Flow definition<a class="headerlink" href="#flow-definition" title="Permalink to this headline">¶</a></h2>
<p>A flow definition is placed into list of flow definitions in YAML configuration file.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">flow-definitions</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;myFirstFlow&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">propagate_parent</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;subflow1&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">propagate_finished</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;subflow1&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">propagate_node_args</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;subflow1&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">nowait</span><span class="p p-Indicator">:</span>
     <span class="p p-Indicator">-</span> <span class="s">&#39;Task1&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">edges</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">from</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="s">&#39;InitTask&#39;</span>
        <span class="l l-Scalar l-Scalar-Plain">to</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="s">&#39;Task1&#39;</span>
          <span class="p p-Indicator">-</span> <span class="s">&#39;subflow1&#39;</span>
        <span class="l l-Scalar l-Scalar-Plain">condition</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;alwaysTrue&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">failures</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">nodes</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="s">&#39;InitTask&#39;</span>
          <span class="l l-Scalar l-Scalar-Plain">fallback</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="s">&#39;InitFallbackTask&#39;</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">from</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">to</span><span class="p p-Indicator">:</span> <span class="s">&#39;InitTask1&#39;</span>

  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&#39;subflow1&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">from</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">to</span><span class="p p-Indicator">:</span> <span class="s">&#39;AnotherTask&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">condition</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;alwaysTrue&quot;</span>
</pre></div>
</div>
<p>Configuration options:</p>
<div class="section" id="id4">
<h3><cite>name</cite><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>A name of flow. This name is used to refer flow.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string</li>
</ul>
</li>
<li>Required: True</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="propagate-parent">
<h3><cite>propagate_parent</cite><a class="headerlink" href="#propagate-parent" title="Permalink to this headline">¶</a></h3>
<p>Propagate parent nodes to subflow or subflows, see task implementation for more details.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string - a name of flow to which parent nodes should be propagated</li>
<li>list of strings - a list of flow names to which parent nodes should be propagated</li>
<li>boolean - enable or disable parent nodes propagation to all subflows</li>
</ul>
</li>
<li>Required: False</li>
</ul>
</div></blockquote>
<p>Default: False - do not propagate parent to any subflow</p>
</div>
<div class="section" id="propagate-finished">
<h3><cite>propagate_finished</cite><a class="headerlink" href="#propagate-finished" title="Permalink to this headline">¶</a></h3>
<p>Propagate finished node ids from subflows. Finished nodes from subflows will be passed as dictionary in parent dict. All task ids will be recursively received from all subflows of inspected flow. See task implementation for more details.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string - a name of flow from which finished should be propagated</li>
<li>list of strings - a list of flow names from which finished nodes should be propagated</li>
<li>boolean - enable or disable finished nodes propagation from all subflows</li>
</ul>
</li>
<li>Required: False</li>
</ul>
</div></blockquote>
<p>Default: False - do not propagate finished from any subflow</p>
</div>
<div class="section" id="propagate-node-args">
<h3><cite>propagate_node_args</cite><a class="headerlink" href="#propagate-node-args" title="Permalink to this headline">¶</a></h3>
<p>Propagate node arguments to subflows.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string - a name of flow to which node arguments should be propagated</li>
<li>list of strings - a list of flow names to which node arguments should be propagated</li>
<li>boolean - enable or disable node arguments propagation to all subflows</li>
</ul>
</li>
<li>Required: False</li>
</ul>
</div></blockquote>
<p>Default: False - do not propagate flow arguments to any subflow</p>
</div>
<div class="section" id="nowait">
<h3><cite>nowait</cite><a class="headerlink" href="#nowait" title="Permalink to this headline">¶</a></h3>
<p>Do not wait for node to finish. This node cannot be stated as a dependency in YAML configuration file. Note that node failure will not be tracked if marked as nowait.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string - a node that should be started with nowait flag</li>
<li>list of strings - a list of nodes that should be started with nowait flag</li>
</ul>
</li>
<li>Required: False</li>
</ul>
</div></blockquote>
<p>Default: False - wait for all nodes to complete</p>
</div>
<div class="section" id="edges">
<h3><cite>edges</cite><a class="headerlink" href="#edges" title="Permalink to this headline">¶</a></h3>
<p>A list of edges describing dependency on nodes. See Edge Definition in a Flow section.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>list of edge definition</li>
</ul>
</li>
<li>Required: True</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="edges-definition-in-a-flow">
<h2>Edges Definition in a Flow<a class="headerlink" href="#edges-definition-in-a-flow" title="Permalink to this headline">¶</a></h2>
<div class="section" id="from">
<h3><cite>from</cite><a class="headerlink" href="#from" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string</li>
<li>list of strings</li>
<li>None</li>
</ul>
</li>
<li>Required: True</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="to">
<h3><cite>to</cite><a class="headerlink" href="#to" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string</li>
<li>list of strings</li>
<li>boolean</li>
</ul>
</li>
<li>Required: True</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="condition">
<h3><cite>condition</cite><a class="headerlink" href="#condition" title="Permalink to this headline">¶</a></h3>
<p>A condition made of predicates. Boolean operators <cite>and</cite>, <cite>or</cite> and not can be used as desired. See Condition Definition section for more info.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>condition definition</li>
</ul>
</li>
<li>Required: True</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="failures">
<h3><cite>failures</cite><a class="headerlink" href="#failures" title="Permalink to this headline">¶</a></h3>
<p>A list of failures that can occur in the system and their fallbacks. See Failures and Fallback section for more info.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>list of failures</li>
</ul>
</li>
<li>Required: False</li>
</ul>
</div></blockquote>
<p>Default: None</p>
</div>
</div>
<div class="section" id="conditions-and-predicates">
<h2>Conditions and Predicates<a class="headerlink" href="#conditions-and-predicates" title="Permalink to this headline">¶</a></h2>
<p>You can start a node based on particular conditions that needs to be met. These conditions can be either external (e.g. availability of a remote server) or flow specific (e.g. results of tasks, arguments that are passed to flow, etc.). A list of all predicates can be found in <a class="reference external" href="https://github.com/fridex/selinonlib">Selinonlib tool</a> in <cite>selinonlib.predicates</cite> module, which is also the default module to be used for predicates.</p>
<p>If you would like to use your own predicates, just state <cite>predicate_module</cite> in your YAML configuration file in <cite>global</cite> section.</p>
<div class="section" id="predicate-module">
<h3><cite>predicate_module</cite><a class="headerlink" href="#predicate-module" title="Permalink to this headline">¶</a></h3>
<p>Use a custom predicate module.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string - predicate module import</li>
</ul>
</li>
<li>Required: False</li>
</ul>
</div></blockquote>
<p>Default: &#8216;selinonlib.predicates&#8217;</p>
<p>All predicates tend to be safe - they do not raise any exception. This would cause fatal error to flow. Instead they return either <cite>True</cite> or <cite>False</cite>. Nothing in-between. That means that if desired condition cannot be satisfied (e.g. requested key in result is not present), <cite>False</cite> is returned.</p>
<p>More complex boolean conditions can be created using build-in support for boolean operators <cite>and</cite>, <cite>or</cite> and <cite>not</cite>. Operators <cite>and</cite> and <cite>or</cite> are n-ary boolean operators (they accept a list of predicates that need to be evaluated, short circuit evaluation is applied). Logical operator <cite>not</cite> is unary.</p>
<p>A condition can look like the following example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">condition</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;fieldEqual&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">node</span><span class="p p-Indicator">:</span> <span class="s">&quot;task1&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">args</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;foo&#39;</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;bar&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span> <span class="s">&#39;baz&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3><cite>name</cite><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>A name of predicate that should be used in condition.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string - predicate name</li>
</ul>
</li>
<li>Required: True</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="node">
<h3><cite>node</cite><a class="headerlink" href="#node" title="Permalink to this headline">¶</a></h3>
<p>A node name that is inspected in the condition. The node has to participate on flow - has to be stated as a dependency node. This flag is required only if predicate requires results of particular node.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string - a node name</li>
</ul>
</li>
<li>Required: False if predicate does not require a result of task or there is dependency on a single task, True if condition is evaluated on multiple dependent nodes and predicate expects node results</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>Default:</dt>
<dd>None if predicate does not require a result of task.
If there is only dependency on a single node stated in <cite>from</cite>, node is automatically computed.</dd>
</dl>
</div>
<div class="section" id="args">
<h3><cite>args</cite><a class="headerlink" href="#args" title="Permalink to this headline">¶</a></h3>
<p>Arguments to predicate that should be passed. These arguments are dependent on used predicate - see selinonlib.predicates for list of all predicates available.</p>
<p>Predicates were designed to use &#8220;listed keys&#8221; as shown in the example - if a list of keys is provided, these keys are deferred as one would intuitively expect. For example the condition listed above will be roughly translated (without exception checks):</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">result[&#39;foo&#39;][&#39;bar&#39;] == &#39;baz&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="failures-and-fallback">
<h2>Failures and Fallback<a class="headerlink" href="#failures-and-fallback" title="Permalink to this headline">¶</a></h2>
<p>You can define a fallback that should be run if there is a failure in your flow. There is stated a failure definition:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">failures</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">nodes</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;Task1&#39;</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;Task2&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">fallback</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;FallbackTask&#39;</span>
</pre></div>
</div>
<p>You can specify multiple fallbacks in your flow based on nodes failure. The highest priority for Dispatcher is to succeed with the flow. Thus if you define nodes that can fail, here is how Dispatcher is trying to recover from a failure:</p>
<blockquote>
<div><ul class="simple">
<li>Fallbacks are run once there are no active nodes in the flow - Dispatcher is trying to recover from failures in this place.</li>
<li>There is scheduled one fallback at the time - this prevents from time dependency in failures</li>
<li>There is always chosen failure based how many nodes you expect to fail - Dispatcher is greedy with fallback - that means it always choose failure that is dependent on highest number of nodes. If multiple failures can be chosen, lexical order of node names comes in place.</li>
<li>A flow fails if there is still a node that failed and there is no failure specified to recover from failure.</li>
<li>Fallback on fallback is fully supported (and nested as desired).</li>
</ul>
</div></blockquote>
<div class="section" id="nodes">
<h3><cite>nodes</cite><a class="headerlink" href="#nodes" title="Permalink to this headline">¶</a></h3>
<p>Describes fallback dependency on node or nodes. Fallback is run if all nodes in listed in <cite>nodes</cite> failed and there is no failure that can be run before defined fallback.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string - a node name that triggers fallback</li>
<li>list of strings - list of node names that are trigger fallback</li>
</ul>
</li>
<li>Required: True</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="fallback">
<h3><cite>fallback</cite><a class="headerlink" href="#fallback" title="Permalink to this headline">¶</a></h3>
<p>Fallback that should be applied on failure.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string - a node name that will be run on failure</li>
<li>list of strings - list of names of nodes that will be run in case of failure</li>
<li>true - if failure should be ignored, no node is run, but failure is not treated as fatal</li>
</ul>
</li>
<li>Required: True</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="global-configuration">
<h2>Global Configuration<a class="headerlink" href="#global-configuration" title="Permalink to this headline">¶</a></h2>
<p>Global configuration section for Selinon library. Possible keys:</p>
<div class="section" id="predicates-module">
<h3><cite>predicates_module</cite><a class="headerlink" href="#predicates-module" title="Permalink to this headline">¶</a></h3>
<p>Predicates package that should be used for predicates stated in conditions:</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string - import to be used for predicates</li>
</ul>
</li>
<li>Required: False</li>
</ul>
</div></blockquote>
<p>Default: &#8216;selinonlib.predicates&#8217; - see <a class="reference external" href="https://fridex.github.io/selinonlib/api/selinonlib.predicates.html">Selinonlib predicates package</a>.</p>
</div>
<div class="section" id="strategy-module">
<h3><cite>strategy_module</cite><a class="headerlink" href="#strategy-module" title="Permalink to this headline">¶</a></h3>
<p>Dispatcher scheduling function that should be used to schedule dispatcher. Here you can optimize your flow not to schedule dispatcher too frequent or not frequent enought.</p>
<blockquote>
<div><ul>
<li><p class="first">Possible values:</p>
<ul>
<li><dl class="first docutils">
<dt><cite>strategy_module</cite></dt>
<dd><p class="first last">Module that should be used to import scheduling function
Default: &#8216;selinonlib.strategies&#8217; <a class="reference external" href="https://fridex.github.io/selinonlib/api/selinonlib.strategies.html">Selinonlib strategies module</a>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>strategy_function</cite> = &#8216;biexponential_increase&#8217;</dt>
<dd><p class="first last">Function that should be imported from strategy module.
Default: &#8216;biexponential_increase&#8217; <a class="reference external" href="https://fridex.github.io/selinonlib/api/selinonlib.strategies.html#selinonlib.strategies.biexponential_increase">Selinonlib strategies module</a>.</p>
</dd>
</dl>
</li>
</ul>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="default-task-queue">
<h3><cite>default_task_queue</cite><a class="headerlink" href="#default-task-queue" title="Permalink to this headline">¶</a></h3>
<p>Default queue for tasks. This queue will be used for all tasks (overrides default Celery queue), unless you specify <cite>queue</cite> in task definition, which has the highest priority.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string - queue for tasks</li>
</ul>
</li>
<li>Required: False</li>
</ul>
</div></blockquote>
<p>Default: &#8216;celery&#8217; - Celery&#8217;s default queue</p>
</div>
<div class="section" id="config-dispatcher-queue">
<h3><cite>config_dispatcher_queue</cite><a class="headerlink" href="#config-dispatcher-queue" title="Permalink to this headline">¶</a></h3>
<p>Queue for dispatcher task.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>string - queue for dispatcher</li>
</ul>
</li>
<li>Required: False</li>
</ul>
</div></blockquote>
<p>Default: &#8216;celery&#8217; - Celery&#8217;s default queue</p>
</div>
<div class="section" id="trace">
<h3><cite>trace</cite><a class="headerlink" href="#trace" title="Permalink to this headline">¶</a></h3>
<p>Keep track of actions that are done in flow. See <a class="reference external" href="https://fridex.github.io/selinon/trace.html">trace</a> module for more info.</p>
<blockquote>
<div><ul class="simple">
<li>Possible types:<ul>
<li>true - use Python&#8217;s logging</li>
<li>values:<ul>
<li><cite>storage</cite> - use already defined storage, if you want to recycle connection. You can also adopt <cite>method</cite> in order to configure method that should be called.</li>
<li><cite>import</cite> - specify module that should be used to import function defined by <cite>function</cite> (<cite>log</cite> by default). This function will be called as described in <a class="reference external" href="https://fridex.github.io/selinon/trace.html">trace</a>.</li>
</ul>
</li>
</ul>
</li>
<li>Required: False</li>
</ul>
</div></blockquote>
<p>Default: do not trace flow actions</p>
</div>
</div>
<div class="section" id="organization-of-configuration-in-yaml-configuration-file">
<h2>Organization of configuration in YAML configuration file<a class="headerlink" href="#organization-of-configuration-in-yaml-configuration-file" title="Permalink to this headline">¶</a></h2>
<p>If you have a lot of flows or you want to combine flows in different way, you can place configuration of entities (<cite>tasks</cite>, <cite>storages</cite> and <cite>flows</cite>) into one file (called <cite>nodes.yaml</cite>) and flow definitions can be split into separate files.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3><a href="index.html">Main Content</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="start.html">A Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="start.html#more-info">More info</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions (FAQ)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">YAML Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="tasks.html">Task Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">Storage Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="trace.html">Trace Flow Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns.html">Useful Flow Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/selinon.html">selinon package</a></li>
</ul>

  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">YAML Configuration</a><ul>
<li><a class="reference internal" href="#entities-in-system">Entities in System</a></li>
<li><a class="reference internal" href="#tasks">Tasks</a><ul>
<li><a class="reference internal" href="#name"><cite>name</cite></a></li>
<li><a class="reference internal" href="#import"><cite>import</cite></a></li>
<li><a class="reference internal" href="#classname"><cite>classname</cite></a></li>
<li><a class="reference internal" href="#max-retry"><cite>max_retry</cite></a></li>
<li><a class="reference internal" href="#retry-countdown"><cite>retry_countdown</cite></a></li>
<li><a class="reference internal" href="#output-schema"><cite>output_schema</cite></a></li>
<li><a class="reference internal" href="#storage"><cite>storage</cite></a></li>
<li><a class="reference internal" href="#queue"><cite>queue</cite></a></li>
</ul>
</li>
<li><a class="reference internal" href="#storages">Storages</a><ul>
<li><a class="reference internal" href="#id1"><cite>name</cite></a></li>
<li><a class="reference internal" href="#id2"><cite>import</cite></a></li>
<li><a class="reference internal" href="#id3"><cite>classname</cite></a></li>
<li><a class="reference internal" href="#configuration"><cite>configuration</cite></a></li>
</ul>
</li>
<li><a class="reference internal" href="#flows">Flows</a></li>
<li><a class="reference internal" href="#flow-definition">Flow definition</a><ul>
<li><a class="reference internal" href="#id4"><cite>name</cite></a></li>
<li><a class="reference internal" href="#propagate-parent"><cite>propagate_parent</cite></a></li>
<li><a class="reference internal" href="#propagate-finished"><cite>propagate_finished</cite></a></li>
<li><a class="reference internal" href="#propagate-node-args"><cite>propagate_node_args</cite></a></li>
<li><a class="reference internal" href="#nowait"><cite>nowait</cite></a></li>
<li><a class="reference internal" href="#edges"><cite>edges</cite></a></li>
</ul>
</li>
<li><a class="reference internal" href="#edges-definition-in-a-flow">Edges Definition in a Flow</a><ul>
<li><a class="reference internal" href="#from"><cite>from</cite></a></li>
<li><a class="reference internal" href="#to"><cite>to</cite></a></li>
<li><a class="reference internal" href="#condition"><cite>condition</cite></a></li>
<li><a class="reference internal" href="#failures"><cite>failures</cite></a></li>
</ul>
</li>
<li><a class="reference internal" href="#conditions-and-predicates">Conditions and Predicates</a><ul>
<li><a class="reference internal" href="#predicate-module"><cite>predicate_module</cite></a></li>
<li><a class="reference internal" href="#id5"><cite>name</cite></a></li>
<li><a class="reference internal" href="#node"><cite>node</cite></a></li>
<li><a class="reference internal" href="#args"><cite>args</cite></a></li>
</ul>
</li>
<li><a class="reference internal" href="#failures-and-fallback">Failures and Fallback</a><ul>
<li><a class="reference internal" href="#nodes"><cite>nodes</cite></a></li>
<li><a class="reference internal" href="#fallback"><cite>fallback</cite></a></li>
</ul>
</li>
<li><a class="reference internal" href="#global-configuration">Global Configuration</a><ul>
<li><a class="reference internal" href="#predicates-module"><cite>predicates_module</cite></a></li>
<li><a class="reference internal" href="#strategy-module"><cite>strategy_module</cite></a></li>
<li><a class="reference internal" href="#default-task-queue"><cite>default_task_queue</cite></a></li>
<li><a class="reference internal" href="#config-dispatcher-queue"><cite>config_dispatcher_queue</cite></a></li>
<li><a class="reference internal" href="#trace"><cite>trace</cite></a></li>
</ul>
</li>
<li><a class="reference internal" href="#organization-of-configuration-in-yaml-configuration-file">Organization of configuration in YAML configuration file</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="faq.html" title="previous chapter">Frequently Asked Questions (FAQ)</a></li>
      <li>Next: <a href="tasks.html" title="next chapter">Task Implementation</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/yaml.conf.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Fridolin Pokorny.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/yaml.conf.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/fridex/selinon" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>